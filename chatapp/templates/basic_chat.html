<!-- templates/chat.html -->

<!DOCTYPE html>
<html>
<head>
    <title>Chat Application</title>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const apiUrl = '{% url "message-list" %}';
            const csrfToken = '{{ csrf_token }}';

            async function loadMessages() {
                const response = await fetch(apiUrl, {
                    headers: {
                        'Authorization': 'Basic ' + btoa('username:password'),  // Replace with actual username and password
                        'X-CSRFToken': csrfToken
                    }
                });
                const messages = await response.json();

                const messagesList = document.getElementById('messages');
                messagesList.innerHTML = '';

                messages.forEach(message => {
                    const li = document.createElement('li');
                    li.textContent = message.content;
                    messagesList.appendChild(li);
                });
            }

            document.addEventListener('DOMContentLoaded', async function() {
                const response = await fetch('/recommend/');
                const data = await response.json();
                console.log(data.recommendations);  // Handle the recommendations
            });

            document.getElementById('message-form').addEventListener('submit', async function(event) {
                event.preventDefault();
                const messageInput = document.getElementById('message-input');
                const content = messageInput.value;

                // Send message to server and get sentiment analysis
                const response = await fetch('/analyze-message/', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': csrfToken
                    },
                    body: JSON.stringify({ message: content })
                });
    
                const sentiment = await response.json();
                console.log(sentiment);  // Handle the sentiment analysis result

                // Rest of your message sending logic
            });

            loadMessages();
        });
    </script>
</head>
<body>
    <h1>Chat Messages</h1>
    <ul id="messages">
        <!-- Messages will be loaded here -->
    </ul>
    <form id="message-form">
        <input type="text" id="message-input" placeholder="Type a message...">
        <button type="submit">Send</button>
    </form>
</body>
</html>
